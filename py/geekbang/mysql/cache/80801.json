{"video_id": "", "sku": "100020801", "video_cover": "", "author_name": "\u6797\u6653\u658c", "text_read_version": 2, "audio_size": 11794993, "article_cover": "https://static001.geekbang.org/resource/image/cd/d1/cdc3c75524018404710ada288e0e07d1.jpg", "product_type": "c1", "audio_url": "https://res001.geekbang.org//media/audio/48/fa/4874e8adceee873b26f38770cf64dcfa/ld/ld.m3u8", "chapter_id": "474", "column_had_sub": true, "audio_dubber": "\u6797\u6653\u658c", "is_finished": false, "neighbors": {"left": {"article_title": "39 | \u81ea\u589e\u4e3b\u952e\u4e3a\u4ec0\u4e48\u4e0d\u662f\u8fde\u7eed\u7684\uff1f", "id": 80531}, "right": {"article_title": "41 | \u600e\u4e48\u6700\u5feb\u5730\u590d\u5236\u4e00\u5f20\u8868\uff1f", "id": 81925}}, "product_id": 100020801, "video_height": 0, "rate_percent": 70, "article_content": "<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u63d0\u5230MySQL\u5bf9\u81ea\u589e\u4e3b\u952e\u9501\u505a\u4e86\u4f18\u5316\uff0c\u5c3d\u91cf\u5728\u7533\u8bf7\u5230\u81ea\u589eid\u4ee5\u540e\uff0c\u5c31\u91ca\u653e\u81ea\u589e\u9501\u3002</p><p>\u56e0\u6b64\uff0cinsert\u8bed\u53e5\u662f\u4e00\u4e2a\u5f88\u8f7b\u91cf\u7684\u64cd\u4f5c\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5bf9\u4e8e\u201c\u666e\u901a\u7684insert\u8bed\u53e5\u201d\u624d\u6709\u6548\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd8\u6709\u4e9binsert\u8bed\u53e5\u662f\u5c5e\u4e8e\u201c\u7279\u6b8a\u60c5\u51b5\u201d\u7684\uff0c\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u7ed9\u5176\u4ed6\u8d44\u6e90\u52a0\u9501\uff0c\u6216\u8005\u65e0\u6cd5\u5728\u7533\u8bf7\u5230\u81ea\u589eid\u4ee5\u540e\u5c31\u7acb\u9a6c\u91ca\u653e\u81ea\u589e\u9501\u3002</p><p>\u90a3\u4e48\uff0c\u4eca\u5929\u8fd9\u7bc7\u6587\u7ae0\uff0c\u6211\u4eec\u5c31\u4e00\u8d77\u6765\u804a\u804a\u8fd9\u4e2a\u8bdd\u9898\u3002</p><h1>insert \u2026 select \u8bed\u53e5</h1><p>\u6211\u4eec\u5148\u4ece\u6628\u5929\u7684\u95ee\u9898\u8bf4\u8d77\u5427\u3002\u8868t\u548ct2\u7684\u8868\u7ed3\u6784\u3001\u521d\u59cb\u5316\u6570\u636e\u8bed\u53e5\u5982\u4e0b\uff0c\u4eca\u5929\u7684\u4f8b\u5b50\u6211\u4eec\u8fd8\u662f\u9488\u5bf9\u8fd9\u4e24\u4e2a\u8868\u5c55\u5f00\u3002</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(null, 1,1);\ninsert into t values(null, 2,2);\ninsert into t values(null, 3,3);\ninsert into t values(null, 4,4);\n\ncreate table t2 like t\n</code></pre><p>\u73b0\u5728\uff0c\u6211\u4eec\u4e00\u8d77\u6765\u770b\u770b\u4e3a\u4ec0\u4e48\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0cbinlog_format=statement\u65f6\u6267\u884c\uff1a</p><pre><code>insert into t2(c,d) select c,d from t;\n</code></pre><p>\u8fd9\u4e2a\u8bed\u53e5\u65f6\uff0c\u9700\u8981\u5bf9\u8868t\u7684\u6240\u6709\u884c\u548c\u95f4\u9699\u52a0\u9501\u5462\uff1f</p><p>\u5176\u5b9e\uff0c\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u9700\u8981\u8003\u8651\u7684\u8fd8\u662f\u65e5\u5fd7\u548c\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6267\u884c\u5e8f\u5217\uff1a</p><p><img src=\"https://static001.geekbang.org/resource/image/33/86/33e513ee55d5700dc67f32bcdafb9386.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe1 \u5e76\u53d1insert\u573a\u666f</span></center><p>\u5b9e\u9645\u7684\u6267\u884c\u6548\u679c\u662f\uff0c\u5982\u679csession B\u5148\u6267\u884c\uff0c\u7531\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u5bf9\u8868t\u4e3b\u952e\u7d22\u5f15\u52a0\u4e86(-\u221e,1]\u8fd9\u4e2anext-key lock\uff0c\u4f1a\u5728\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u5141\u8bb8session A\u7684insert\u8bed\u53e5\u6267\u884c\u3002</p><p>\u4f46\u5982\u679c\u6ca1\u6709\u9501\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0session B\u7684insert\u8bed\u53e5\u5148\u6267\u884c\uff0c\u4f46\u662f\u540e\u5199\u5165binlog\u7684\u60c5\u51b5\u3002\u4e8e\u662f\uff0c\u5728binlog_format=statement\u7684\u60c5\u51b5\u4e0b\uff0cbinlog\u91cc\u9762\u5c31\u8bb0\u5f55\u4e86\u8fd9\u6837\u7684\u8bed\u53e5\u5e8f\u5217\uff1a</p><!-- [[[read_end]]] --><pre><code>insert into t values(-1,-1,-1);\ninsert into t2(c,d) select c,d from t;\n</code></pre><p>\u8fd9\u4e2a\u8bed\u53e5\u5230\u4e86\u5907\u5e93\u6267\u884c\uff0c\u5c31\u4f1a\u628aid=-1\u8fd9\u4e00\u884c\u4e5f\u5199\u5230\u8868t2\u4e2d\uff0c\u51fa\u73b0\u4e3b\u5907\u4e0d\u4e00\u81f4\u3002</p><h1>insert \u5faa\u73af\u5199\u5165</h1><p>\u5f53\u7136\u4e86\uff0c\u6267\u884cinsert \u2026 select \u7684\u65f6\u5019\uff0c\u5bf9\u76ee\u6807\u8868\u4e5f\u4e0d\u662f\u9501\u5168\u8868\uff0c\u800c\u662f\u53ea\u9501\u4f4f\u9700\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\u3002</p><p>\u5982\u679c\u73b0\u5728\u6709\u8fd9\u4e48\u4e00\u4e2a\u9700\u6c42\uff1a\u8981\u5f80\u8868t2\u4e2d\u63d2\u5165\u4e00\u884c\u6570\u636e\uff0c\u8fd9\u4e00\u884c\u7684c\u503c\u662f\u8868t\u4e2dc\u503c\u7684\u6700\u5927\u503c\u52a01\u3002</p><p>\u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5199\u8fd9\u6761SQL\u8bed\u53e5 \uff1a</p><pre><code>insert into t2(c,d)  (select c+1, d from t force index(c) order by c desc limit 1);\n</code></pre><p>\u8fd9\u4e2a\u8bed\u53e5\u7684\u52a0\u9501\u8303\u56f4\uff0c\u5c31\u662f\u8868t\u7d22\u5f15c\u4e0a\u7684(3,4]\u548c(4,supremum]\u8fd9\u4e24\u4e2anext-key lock\uff0c\u4ee5\u53ca\u4e3b\u952e\u7d22\u5f15\u4e0aid=4\u8fd9\u4e00\u884c\u3002</p><p>\u5b83\u7684\u6267\u884c\u6d41\u7a0b\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u4ece\u8868t\u4e2d\u6309\u7167\u7d22\u5f15c\u5012\u5e8f\uff0c\u626b\u63cf\u7b2c\u4e00\u884c\uff0c\u62ff\u5230\u7ed3\u679c\u5199\u5165\u5230\u8868t2\u4e2d\u3002</p><p>\u56e0\u6b64\u6574\u6761\u8bed\u53e5\u7684\u626b\u63cf\u884c\u6570\u662f1\u3002</p><p>\u8fd9\u4e2a\u8bed\u53e5\u6267\u884c\u7684\u6162\u67e5\u8be2\u65e5\u5fd7\uff08slow log\uff09\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/74/3efdf8256309a44e23d93089459eda74.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe2 \u6162\u67e5\u8be2\u65e5\u5fd7--\u5c06\u6570\u636e\u63d2\u5165\u8868t2</span></center><p>\u901a\u8fc7\u8fd9\u4e2a\u6162\u67e5\u8be2\u65e5\u5fd7\uff0c\u6211\u4eec\u770b\u5230Rows_examined=1\uff0c\u6b63\u597d\u9a8c\u8bc1\u4e86\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u7684\u626b\u63cf\u884c\u6570\u4e3a1\u3002</p><p>\u90a3\u4e48\uff0c\u5982\u679c\u6211\u4eec\u662f\u8981\u628a\u8fd9\u6837\u7684\u4e00\u884c\u6570\u636e\u63d2\u5165\u5230\u8868t\u4e2d\u7684\u8bdd\uff1a</p><pre><code>insert into t(c,d)  (select c+1, d from t force index(c) order by c desc limit 1);\n</code></pre><p>\u8bed\u53e5\u7684\u6267\u884c\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1f\u626b\u63cf\u884c\u6570\u53c8\u662f\u591a\u5c11\u5462\uff1f</p><p>\u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u518d\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u5c31\u4f1a\u53d1\u73b0\u4e0d\u5bf9\u4e86\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/6f/18/6f90b04c09188bff11dae6e788abb918.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe3 \u6162\u67e5\u8be2\u65e5\u5fd7--\u5c06\u6570\u636e\u63d2\u5165\u8868t</span></center><p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u65f6\u5019\u7684Rows_examined\u7684\u503c\u662f5\u3002</p><p>\u6211\u5728\u524d\u9762\u7684\u6587\u7ae0\u4e2d\u63d0\u5230\u8fc7\uff0c\u5e0c\u671b\u4f60\u90fd\u80fd\u591f\u5b66\u4f1a\u7528explain\u7684\u7ed3\u679c\u6765\u201c\u8111\u8865\u201d\u6574\u6761\u8bed\u53e5\u7684\u6267\u884c\u8fc7\u7a0b\u3002\u4eca\u5929\uff0c\u6211\u4eec\u5c31\u6765\u4e00\u8d77\u8bd5\u8bd5\u3002</p><p>\u5982\u56fe4\u6240\u793a\u5c31\u662f\u8fd9\u6761\u8bed\u53e5\u7684explain\u7ed3\u679c\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/2a/d7270781ee3f216325b73bd53999b82a.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe4 explain\u7ed3\u679c</span></center><p>\u4eceExtra\u5b57\u6bb5\u53ef\u4ee5\u770b\u5230\u201cUsing temporary\u201d\u5b57\u6837\uff0c\u8868\u793a\u8fd9\u4e2a\u8bed\u53e5\u7528\u5230\u4e86\u4e34\u65f6\u8868\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u628a\u8868t\u7684\u5185\u5bb9\u8bfb\u51fa\u6765\uff0c\u5199\u5165\u4e34\u65f6\u8868\u3002</p><p>\u56fe\u4e2drows\u663e\u793a\u7684\u662f1\uff0c\u6211\u4eec\u4e0d\u59a8\u5148\u5bf9\u8fd9\u4e2a\u8bed\u53e5\u7684\u6267\u884c\u6d41\u7a0b\u505a\u4e00\u4e2a\u731c\u6d4b\uff1a\u5982\u679c\u8bf4\u662f\u628a\u5b50\u67e5\u8be2\u7684\u7ed3\u679c\u8bfb\u51fa\u6765\uff08\u626b\u63cf1\u884c\uff09\uff0c\u5199\u5165\u4e34\u65f6\u8868\uff0c\u7136\u540e\u518d\u4ece\u4e34\u65f6\u8868\u8bfb\u51fa\u6765\uff08\u626b\u63cf1\u884c\uff09\uff0c\u5199\u56de\u8868t\u4e2d\u3002\u90a3\u4e48\uff0c\u8fd9\u4e2a\u8bed\u53e5\u7684\u626b\u63cf\u884c\u6570\u5c31\u5e94\u8be5\u662f2\uff0c\u800c\u4e0d\u662f5\u3002</p><p>\u6240\u4ee5\uff0c\u8fd9\u4e2a\u731c\u6d4b\u4e0d\u5bf9\u3002\u5b9e\u9645\u4e0a\uff0cExplain\u7ed3\u679c\u91cc\u7684rows=1\u662f\u56e0\u4e3a\u53d7\u5230\u4e86limit 1 \u7684\u5f71\u54cd\u3002</p><p>\u4ece\u53e6\u4e00\u4e2a\u89d2\u5ea6\u8003\u8651\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u770bInnoDB\u626b\u63cf\u4e86\u591a\u5c11\u884c\u3002\u5982\u56fe5\u6240\u793a\uff0c\u662f\u5728\u6267\u884c\u8fd9\u4e2a\u8bed\u53e5\u524d\u540e\u67e5\u770bInnodb_rows_read\u7684\u7ed3\u679c\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/48/d7/489281d8029e8f60979cb7c4494010d7.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe5 \u67e5\u770b Innodb_rows_read\u53d8\u5316</span></center><p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u8bed\u53e5\u6267\u884c\u524d\u540e\uff0cInnodb_rows_read\u7684\u503c\u589e\u52a0\u4e864\u3002\u56e0\u4e3a\u9ed8\u8ba4\u4e34\u65f6\u8868\u662f\u4f7f\u7528Memory\u5f15\u64ce\u7684\uff0c\u6240\u4ee5\u8fd94\u884c\u67e5\u7684\u90fd\u662f\u8868t\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u8868t\u505a\u4e86\u5168\u8868\u626b\u63cf\u3002</p><p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u628a\u6574\u4e2a\u6267\u884c\u8fc7\u7a0b\u7406\u6e05\u695a\u4e86\uff1a</p><ol>\n<li>\n<p>\u521b\u5efa\u4e34\u65f6\u8868\uff0c\u8868\u91cc\u6709\u4e24\u4e2a\u5b57\u6bb5c\u548cd\u3002</p>\n</li>\n<li>\n<p>\u6309\u7167\u7d22\u5f15c\u626b\u63cf\u8868t\uff0c\u4f9d\u6b21\u53d6c=4\u30013\u30012\u30011\uff0c\u7136\u540e\u56de\u8868\uff0c\u8bfb\u5230c\u548cd\u7684\u503c\u5199\u5165\u4e34\u65f6\u8868\u3002\u8fd9\u65f6\uff0cRows_examined=4\u3002</p>\n</li>\n<li>\n<p>\u7531\u4e8e\u8bed\u4e49\u91cc\u9762\u6709limit 1\uff0c\u6240\u4ee5\u53ea\u53d6\u4e86\u4e34\u65f6\u8868\u7684\u7b2c\u4e00\u884c\uff0c\u518d\u63d2\u5165\u5230\u8868t\u4e2d\u3002\u8fd9\u65f6\uff0cRows_examined\u7684\u503c\u52a01\uff0c\u53d8\u6210\u4e865\u3002</p>\n</li>\n</ol><p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u8bed\u53e5\u4f1a\u5bfc\u81f4\u5728\u8868t\u4e0a\u505a\u5168\u8868\u626b\u63cf\uff0c\u5e76\u4e14\u4f1a\u7ed9\u7d22\u5f15c\u4e0a\u7684\u6240\u6709\u95f4\u9699\u90fd\u52a0\u4e0a\u5171\u4eab\u7684next-key lock\u3002\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8bed\u53e5\u6267\u884c\u671f\u95f4\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e0d\u80fd\u5728\u8fd9\u4e2a\u8868\u4e0a\u63d2\u5165\u6570\u636e\u3002</p><p>\u81f3\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u7684\u6267\u884c\u4e3a\u4ec0\u4e48\u9700\u8981\u4e34\u65f6\u8868\uff0c\u539f\u56e0\u662f\u8fd9\u7c7b\u4e00\u8fb9\u904d\u5386\u6570\u636e\uff0c\u4e00\u8fb9\u66f4\u65b0\u6570\u636e\u7684\u60c5\u51b5\uff0c\u5982\u679c\u8bfb\u51fa\u6765\u7684\u6570\u636e\u76f4\u63a5\u5199\u56de\u539f\u8868\uff0c\u5c31\u53ef\u80fd\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u8bfb\u5230\u521a\u521a\u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u65b0\u63d2\u5165\u7684\u8bb0\u5f55\u5982\u679c\u53c2\u4e0e\u8ba1\u7b97\u903b\u8f91\uff0c\u5c31\u8ddf\u8bed\u4e49\u4e0d\u7b26\u3002</p><p>\u7531\u4e8e\u5b9e\u73b0\u4e0a\u8fd9\u4e2a\u8bed\u53e5\u6ca1\u6709\u5728\u5b50\u67e5\u8be2\u4e2d\u5c31\u76f4\u63a5\u4f7f\u7528limit 1\uff0c\u4ece\u800c\u5bfc\u81f4\u4e86\u8fd9\u4e2a\u8bed\u53e5\u7684\u6267\u884c\u9700\u8981\u904d\u5386\u6574\u4e2a\u8868t\u3002\u5b83\u7684\u4f18\u5316\u65b9\u6cd5\u4e5f\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u7528\u524d\u9762\u4ecb\u7ecd\u7684\u65b9\u6cd5\uff0c\u5148insert into\u5230\u4e34\u65f6\u8868temp_t\uff0c\u8fd9\u6837\u5c31\u53ea\u9700\u8981\u626b\u63cf\u4e00\u884c\uff1b\u7136\u540e\u518d\u4ece\u8868temp_t\u91cc\u9762\u53d6\u51fa\u8fd9\u884c\u6570\u636e\u63d2\u5165\u8868t1\u3002</p><p>\u5f53\u7136\uff0c\u7531\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u6d89\u53ca\u7684\u6570\u636e\u91cf\u5f88\u5c0f\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u5185\u5b58\u4e34\u65f6\u8868\u6765\u505a\u8fd9\u4e2a\u4f18\u5316\u3002\u4f7f\u7528\u5185\u5b58\u4e34\u65f6\u8868\u4f18\u5316\u65f6\uff0c\u8bed\u53e5\u5e8f\u5217\u7684\u5199\u6cd5\u5982\u4e0b\uff1a</p><pre><code>create temporary table temp_t(c int,d int) engine=memory;\ninsert into temp_t  (select c+1, d from t force index(c) order by c desc limit 1);\ninsert into t select * from temp_t;\ndrop table temp_t;\n</code></pre><h1>insert \u552f\u4e00\u952e\u51b2\u7a81</h1><p>\u524d\u9762\u7684\u4e24\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528insert \u2026 select\u7684\u60c5\u51b5\uff0c\u63a5\u4e0b\u6765\u6211\u8981\u4ecb\u7ecd\u7684\u8fd9\u4e2a\u4f8b\u5b50\u5c31\u662f\u6700\u5e38\u89c1\u7684insert\u8bed\u53e5\u51fa\u73b0\u552f\u4e00\u952e\u51b2\u7a81\u7684\u60c5\u51b5\u3002</p><p>\u5bf9\u4e8e\u6709\u552f\u4e00\u952e\u7684\u8868\uff0c\u63d2\u5165\u6570\u636e\u65f6\u51fa\u73b0\u552f\u4e00\u952e\u51b2\u7a81\u4e5f\u662f\u5e38\u89c1\u7684\u60c5\u51b5\u4e86\u3002\u6211\u5148\u7ed9\u4f60\u4e3e\u4e00\u4e2a\u7b80\u5355\u7684\u552f\u4e00\u952e\u51b2\u7a81\u7684\u4f8b\u5b50\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/83/ca/83fb2d877932941b230d6b5be8cca6ca.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe6 \u552f\u4e00\u952e\u51b2\u7a81\u52a0\u9501</span></center><p>\u8fd9\u4e2a\u4f8b\u5b50\u4e5f\u662f\u5728\u53ef\u91cd\u590d\u8bfb\uff08repeatable read\uff09\u9694\u79bb\u7ea7\u522b\u4e0b\u6267\u884c\u7684\u3002\u53ef\u4ee5\u770b\u5230\uff0csession B\u8981\u6267\u884c\u7684insert\u8bed\u53e5\u8fdb\u5165\u4e86\u9501\u7b49\u5f85\u72b6\u6001\u3002</p><p>\u4e5f\u5c31\u662f\u8bf4\uff0csession A\u6267\u884c\u7684insert\u8bed\u53e5\uff0c\u53d1\u751f\u552f\u4e00\u952e\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u53ea\u662f\u7b80\u5355\u5730\u62a5\u9519\u8fd4\u56de\uff0c\u8fd8\u5728\u51b2\u7a81\u7684\u7d22\u5f15\u4e0a\u52a0\u4e86\u9501\u3002\u6211\u4eec\u524d\u9762\u8bf4\u8fc7\uff0c\u4e00\u4e2anext-key lock\u5c31\u662f\u7531\u5b83\u53f3\u8fb9\u754c\u7684\u503c\u5b9a\u4e49\u7684\u3002\u8fd9\u65f6\u5019\uff0csession A\u6301\u6709\u7d22\u5f15c\u4e0a\u7684(5,10]\u5171\u4eabnext-key lock\uff08\u8bfb\u9501\uff09\u3002</p><p>\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u52a0\u8fd9\u4e2a\u8bfb\u9501\uff0c\u5176\u5b9e\u6211\u4e5f\u6ca1\u6709\u627e\u5230\u5408\u7406\u7684\u89e3\u91ca\u3002\u4ece\u4f5c\u7528\u4e0a\u6765\u770b\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u907f\u514d\u8fd9\u4e00\u884c\u88ab\u522b\u7684\u4e8b\u52a1\u5220\u6389\u3002</p><p>\u8fd9\u91cc<a href=\"https://dev.mysql.com/doc/refman/8.0/en/innodb-locks-set.html\">\u5b98\u65b9\u6587\u6863</a>\u6709\u4e00\u4e2a\u63cf\u8ff0\u9519\u8bef\uff0c\u8ba4\u4e3a\u5982\u679c\u51b2\u7a81\u7684\u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u5c31\u52a0\u8bb0\u5f55\u9501\uff0c\u552f\u4e00\u7d22\u5f15\u624d\u52a0next-key lock\u3002\u4f46\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e24\u7c7b\u7d22\u5f15\u51b2\u7a81\u52a0\u7684\u90fd\u662fnext-key lock\u3002</p><blockquote>\n<p>\u5907\u6ce8\uff1a\u8fd9\u4e2abug\uff0c\u662f\u6211\u5728\u5199\u8fd9\u7bc7\u6587\u7ae0\u67e5\u9605\u6587\u6863\u65f6\u53d1\u73b0\u7684\uff0c\u5df2\u7ecf<a href=\"https://bugs.mysql.com/bug.php?id=93806\">\u53d1\u7ed9\u5b98\u65b9</a>\u5e76\u88abverified\u4e86\u3002</p>\n</blockquote><p>\u6709\u540c\u5b66\u5728\u524d\u9762\u6587\u7ae0\u7684\u8bc4\u8bba\u533a\u95ee\u5230\uff0c\u5728\u6709\u591a\u4e2a\u552f\u4e00\u7d22\u5f15\u7684\u8868\u4e2d\u5e76\u53d1\u63d2\u5165\u6570\u636e\u65f6\uff0c\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u4ed6\u6ca1\u6709\u63d0\u4f9b\u590d\u73b0\u65b9\u6cd5\u6216\u8005\u73b0\u573a\uff0c\u6211\u4e5f\u65e0\u6cd5\u505a\u5206\u6790\u3002\u6240\u4ee5\uff0c\u6211\u5efa\u8bae\u4f60\u5728\u8bc4\u8bba\u533a\u53d1\u95ee\u9898\u7684\u65f6\u5019\uff0c\u5c3d\u91cf\u540c\u65f6\u9644\u4e0a\u590d\u73b0\u65b9\u6cd5\uff0c\u6216\u8005\u73b0\u573a\u4fe1\u606f\uff0c\u8fd9\u6837\u6211\u624d\u597d\u548c\u4f60\u4e00\u8d77\u5206\u6790\u95ee\u9898\u3002</p><p>\u8fd9\u91cc\uff0c\u6211\u5c31\u5148\u548c\u4f60\u5206\u4eab\u4e00\u4e2a\u7ecf\u5178\u7684\u6b7b\u9501\u573a\u666f\uff0c\u5982\u679c\u4f60\u8fd8\u9047\u5230\u8fc7\u5176\u4ed6\u552f\u4e00\u952e\u51b2\u7a81\u5bfc\u81f4\u7684\u6b7b\u9501\u573a\u666f\uff0c\u4e5f\u6b22\u8fce\u7ed9\u6211\u7559\u8a00\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/63/2d/63658eb26e7a03b49f123fceed94cd2d.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe7 \u552f\u4e00\u952e\u51b2\u7a81--\u6b7b\u9501</span></center><p>\u5728session A\u6267\u884crollback\u8bed\u53e5\u56de\u6eda\u7684\u65f6\u5019\uff0csession C\u51e0\u4e4e\u540c\u65f6\u53d1\u73b0\u6b7b\u9501\u5e76\u8fd4\u56de\u3002</p><p>\u8fd9\u4e2a\u6b7b\u9501\u4ea7\u751f\u7684\u903b\u8f91\u662f\u8fd9\u6837\u7684\uff1a</p><ol>\n<li>\n<p>\u5728T1\u65f6\u523b\uff0c\u542f\u52a8session A\uff0c\u5e76\u6267\u884cinsert\u8bed\u53e5\uff0c\u6b64\u65f6\u5728\u7d22\u5f15c\u7684c=5\u4e0a\u52a0\u4e86\u8bb0\u5f55\u9501\u3002\u6ce8\u610f\uff0c\u8fd9\u4e2a\u7d22\u5f15\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u56e0\u6b64\u9000\u5316\u4e3a\u8bb0\u5f55\u9501\uff08\u5982\u679c\u4f60\u7684\u5370\u8c61\u6a21\u7cca\u4e86\uff0c\u53ef\u4ee5\u56de\u987e\u4e0b<a href=\"https://time.geekbang.org/column/article/75659\">\u7b2c21\u7bc7\u6587\u7ae0</a>\u4ecb\u7ecd\u7684\u52a0\u9501\u89c4\u5219\uff09\u3002</p>\n</li>\n<li>\n<p>\u5728T2\u65f6\u523b\uff0csession B\u8981\u6267\u884c\u76f8\u540c\u7684insert\u8bed\u53e5\uff0c\u53d1\u73b0\u4e86\u552f\u4e00\u952e\u51b2\u7a81\uff0c\u52a0\u4e0a\u8bfb\u9501\uff1b\u540c\u6837\u5730\uff0csession C\u4e5f\u5728\u7d22\u5f15c\u4e0a\uff0cc=5\u8fd9\u4e00\u4e2a\u8bb0\u5f55\u4e0a\uff0c\u52a0\u4e86\u8bfb\u9501\u3002</p>\n</li>\n<li>\n<p>T3\u65f6\u523b\uff0csession A\u56de\u6eda\u3002\u8fd9\u65f6\u5019\uff0csession B\u548csession C\u90fd\u8bd5\u56fe\u7ee7\u7eed\u6267\u884c\u63d2\u5165\u64cd\u4f5c\uff0c\u90fd\u8981\u52a0\u4e0a\u5199\u9501\u3002\u4e24\u4e2asession\u90fd\u8981\u7b49\u5f85\u5bf9\u65b9\u7684\u884c\u9501\uff0c\u6240\u4ee5\u5c31\u51fa\u73b0\u4e86\u6b7b\u9501\u3002</p>\n</li>\n</ol><p>\u8fd9\u4e2a\u6d41\u7a0b\u7684\u72b6\u6001\u53d8\u5316\u56fe\u5982\u4e0b\u6240\u793a\u3002</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/b8/3e0bf1a1241931c14360e73fd10032b8.jpg\" alt=\"\"></p><center><span class=\"reference\">\u56fe8 \u72b6\u6001\u53d8\u5316\u56fe--\u6b7b\u9501</span></center><h1>insert into \u2026 on duplicate key update</h1><p>\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u4e3b\u952e\u51b2\u7a81\u540e\u76f4\u63a5\u62a5\u9519\uff0c\u5982\u679c\u662f\u6539\u5199\u6210</p><pre><code>insert into t values(11,10,10) on duplicate key update d=100; \n</code></pre><p>\u7684\u8bdd\uff0c\u5c31\u4f1a\u7ed9\u7d22\u5f15c\u4e0a(5,10] \u52a0\u4e00\u4e2a\u6392\u4ed6\u7684next-key lock\uff08\u5199\u9501\uff09\u3002</p><p><strong>insert into \u2026 on duplicate key update \u8fd9\u4e2a\u8bed\u4e49\u7684\u903b\u8f91\u662f\uff0c\u63d2\u5165\u4e00\u884c\u6570\u636e\uff0c\u5982\u679c\u78b0\u5230\u552f\u4e00\u952e\u7ea6\u675f\uff0c\u5c31\u6267\u884c\u540e\u9762\u7684\u66f4\u65b0\u8bed\u53e5\u3002</strong></p><p>\u6ce8\u610f\uff0c\u5982\u679c\u6709\u591a\u4e2a\u5217\u8fdd\u53cd\u4e86\u552f\u4e00\u6027\u7ea6\u675f\uff0c\u5c31\u4f1a\u6309\u7167\u7d22\u5f15\u7684\u987a\u5e8f\uff0c\u4fee\u6539\u8ddf\u7b2c\u4e00\u4e2a\u7d22\u5f15\u51b2\u7a81\u7684\u884c\u3002</p><p>\u73b0\u5728\u8868t\u91cc\u9762\u5df2\u7ecf\u6709\u4e86(1,1,1)\u548c(2,2,2)\u8fd9\u4e24\u884c\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u4e0b\u9762\u8fd9\u4e2a\u8bed\u53e5\u6267\u884c\u7684\u6548\u679c\uff1a</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/02/5f384d6671c87a60e1ec7e490447d702.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe9 \u4e24\u4e2a\u552f\u4e00\u952e\u540c\u65f6\u51b2\u7a81</span></center><p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e3b\u952eid\u662f\u5148\u5224\u65ad\u7684\uff0cMySQL\u8ba4\u4e3a\u8fd9\u4e2a\u8bed\u53e5\u8ddfid=2\u8fd9\u4e00\u884c\u51b2\u7a81\uff0c\u6240\u4ee5\u4fee\u6539\u7684\u662fid=2\u7684\u884c\u3002</p><p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u7684affected rows\u8fd4\u56de\u7684\u662f2\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u8bef\u89e3\u3002\u5b9e\u9645\u4e0a\uff0c\u771f\u6b63\u66f4\u65b0\u7684\u53ea\u6709\u4e00\u884c\uff0c\u53ea\u662f\u5728\u4ee3\u7801\u5b9e\u73b0\u4e0a\uff0cinsert\u548cupdate\u90fd\u8ba4\u4e3a\u81ea\u5df1\u6210\u529f\u4e86\uff0cupdate\u8ba1\u6570\u52a0\u4e861\uff0c insert\u8ba1\u6570\u4e5f\u52a0\u4e861\u3002</p><h1>\u5c0f\u7ed3</h1><p>\u4eca\u5929\u8fd9\u7bc7\u6587\u7ae0\uff0c\u6211\u548c\u4f60\u4ecb\u7ecd\u4e86\u51e0\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\u7684insert\u8bed\u53e5\u3002</p><p>insert \u2026 select \u662f\u5f88\u5e38\u89c1\u7684\u5728\u4e24\u4e2a\u8868\u4e4b\u95f4\u62f7\u8d1d\u6570\u636e\u7684\u65b9\u6cd5\u3002\u4f60\u9700\u8981\u6ce8\u610f\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u8fd9\u4e2a\u8bed\u53e5\u4f1a\u7ed9select\u7684\u8868\u91cc\u626b\u63cf\u5230\u7684\u8bb0\u5f55\u548c\u95f4\u9699\u52a0\u8bfb\u9501\u3002</p><p>\u800c\u5982\u679cinsert\u548cselect\u7684\u5bf9\u8c61\u662f\u540c\u4e00\u4e2a\u8868\uff0c\u5219\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u5faa\u73af\u5199\u5165\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165\u7528\u6237\u4e34\u65f6\u8868\u6765\u505a\u4f18\u5316\u3002</p><p>insert \u8bed\u53e5\u5982\u679c\u51fa\u73b0\u552f\u4e00\u952e\u51b2\u7a81\uff0c\u4f1a\u5728\u51b2\u7a81\u7684\u552f\u4e00\u503c\u4e0a\u52a0\u5171\u4eab\u7684next-key lock(S\u9501)\u3002\u56e0\u6b64\uff0c\u78b0\u5230\u7531\u4e8e\u552f\u4e00\u952e\u7ea6\u675f\u5bfc\u81f4\u62a5\u9519\u540e\uff0c\u8981\u5c3d\u5feb\u63d0\u4ea4\u6216\u56de\u6eda\u4e8b\u52a1\uff0c\u907f\u514d\u52a0\u9501\u65f6\u95f4\u8fc7\u957f\u3002</p><p>\u6700\u540e\uff0c\u6211\u7ed9\u4f60\u7559\u4e00\u4e2a\u95ee\u9898\u5427\u3002</p><p>\u4f60\u5e73\u65f6\u5728\u4e24\u4e2a\u8868\u4e4b\u95f4\u62f7\u8d1d\u6570\u636e\u7528\u7684\u662f\u4ec0\u4e48\u65b9\u6cd5\uff0c\u6709\u4ec0\u4e48\u6ce8\u610f\u4e8b\u9879\u5417\uff1f\u5728\u4f60\u7684\u5e94\u7528\u573a\u666f\u91cc\uff0c\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u76f8\u8f83\u4e8e\u5176\u4ed6\u65b9\u6cd5\u7684\u4f18\u52bf\u662f\u4ec0\u4e48\u5462\uff1f</p><p>\u4f60\u53ef\u4ee5\u628a\u4f60\u7684\u7ecf\u9a8c\u548c\u5206\u6790\u5199\u5728\u8bc4\u8bba\u533a\uff0c\u6211\u4f1a\u5728\u4e0b\u4e00\u7bc7\u6587\u7ae0\u7684\u672b\u5c3e\u9009\u53d6\u6709\u8da3\u7684\u8bc4\u8bba\u6765\u548c\u4f60\u4e00\u8d77\u5206\u6790\u3002\u611f\u8c22\u4f60\u7684\u6536\u542c\uff0c\u4e5f\u6b22\u8fce\u4f60\u628a\u8fd9\u7bc7\u6587\u7ae0\u5206\u4eab\u7ed9\u66f4\u591a\u7684\u670b\u53cb\u4e00\u8d77\u9605\u8bfb\u3002</p><h1>\u4e0a\u671f\u95ee\u9898\u65f6\u95f4</h1><p>\u6211\u4eec\u5df2\u7ecf\u5728\u6587\u7ae0\u4e2d\u56de\u7b54\u4e86\u4e0a\u671f\u95ee\u9898\u3002</p><p>\u6709\u540c\u5b66\u63d0\u5230\uff0c\u5982\u679c\u5728insert \u2026 select \u6267\u884c\u671f\u95f4\u6709\u5176\u4ed6\u7ebf\u7a0b\u64cd\u4f5c\u539f\u8868\uff0c\u4f1a\u5bfc\u81f4\u903b\u8f91\u9519\u8bef\u3002\u5176\u5b9e\uff0c\u8fd9\u662f\u4e0d\u4f1a\u7684\uff0c\u5982\u679c\u4e0d\u52a0\u9501\uff0c\u5c31\u662f\u5feb\u7167\u8bfb\u3002</p><p>\u4e00\u6761\u8bed\u53e5\u6267\u884c\u671f\u95f4\uff0c\u5b83\u7684\u4e00\u81f4\u6027\u89c6\u56fe\u662f\u4e0d\u4f1a\u4fee\u6539\u7684\uff0c\u6240\u4ee5\u5373\u4f7f\u6709\u5176\u4ed6\u4e8b\u52a1\u4fee\u6539\u4e86\u539f\u8868\u7684\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u8fd9\u6761\u8bed\u53e5\u770b\u5230\u7684\u6570\u636e\u3002</p><p>\u8bc4\u8bba\u533a\u7559\u8a00\u70b9\u8d5e\u677f\uff1a</p><blockquote>\n<p>@\u957f\u6770 \u540c\u5b66\u56de\u7b54\u5f97\u975e\u5e38\u51c6\u786e\u3002</p>\n</blockquote><p></p>", "footer_cover_data": {"img_url": "https://static001.geekbang.org/resource/image/98/b5/983009c2431ffbaabc75bf0c31fa72b5.jpg", "link_url": "https://time.geekbang.org/column/intro/287?utm_term=zeus9XT2R&utm_source=geektime&utm_medium=ditutuijian", "mp_url": ""}, "column_is_experience": false, "video_size": 0, "article_cover_hidden": false, "is_required": true, "rate": {"2": {"cur_version": 0, "max_rate": 0, "cur_rate": 0, "is_finished": false, "total_rate": 0, "learned_seconds": 0}, "1": {"cur_version": 1583049492, "max_rate": 69, "cur_rate": 69, "is_finished": false, "total_rate": 99, "learned_seconds": 54}, "3": {"cur_version": 0, "max_rate": 0, "cur_rate": 0, "is_finished": false, "total_rate": 0, "learned_seconds": 0}}, "score": "31549987200", "view_count": 23609, "audio_download_url": "https://static001.geekbang.org/resource/audio/48/fa/4874e8adceee873b26f38770cf64dcfa.mp3", "id": 80801, "had_viewed": true, "article_title": "40 | insert\u8bed\u53e5\u7684\u9501\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u591a\uff1f", "column_bgcolor": "#f6f7f9", "like_count": 81, "had_liked": false, "is_video_preview": false, "article_summary": "insert\u8bed\u53e5\u662f\u4e00\u4e2a\u5f88\u8f7b\u91cf\u7684\u64cd\u4f5c\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5bf9\u4e8e\u201c\u666e\u901a\u7684insert\u8bed\u53e5\u201d\u624d\u6709\u6548\u3002\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bf4\uff1f\u4eca\u5929\uff0c\u6211\u8981\u8ddf\u4f60\u4ecb\u7ecd\u7684\u5c31\u662f\u51e0\u79cdinsert\u8bed\u53e5\u7684\u7279\u6b8a\u60c5\u51b5\u3002", "article_features": 0, "article_could_preview": false, "column_cover": "https://static001.geekbang.org/resource/image/59/db/598593a4da4fd7ea898711cc623292db.jpg", "audio_time_arr": {"m": "12", "s": "16", "h": "00"}, "column_id": 139, "audio_time": "00:12:16", "article_sharetitle": "insert\u8bed\u53e5\u7684\u9501\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u591a\uff1f", "audio_title": "40-dq\u66f4\u65b0", "audio_md5": "4874e8adceee873b26f38770cf64dcfa", "text_read_percent": 109910691473, "article_subtitle": "\u65e0", "cid": 139, "video_time": "", "article_cshort": "<p>\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u63d0\u5230MySQL\u5bf9\u81ea\u589e\u4e3b\u952e\u9501\u505a\u4e86\u4f18\u5316\uff0c\u5c3d\u91cf\u5728\u7533\u8bf7\u5230\u81ea\u589eid\u4ee5\u540e\uff0c\u5c31\u91ca\u653e\u81ea\u589e\u9501\u3002</p><p>\u56e0\u6b64\uff0cinsert\u8bed\u53e5\u662f\u4e00\u4e2a\u5f88\u8f7b\u91cf\u7684\u64cd\u4f5c\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u7ed3\u8bba\u5bf9\u4e8e\u201c\u666e\u901a\u7684insert\u8bed\u53e5\u201d\u624d\u6709\u6548\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd8\u6709\u4e9binsert\u8bed\u53e5\u662f\u5c5e\u4e8e\u201c\u7279\u6b8a\u60c5\u51b5\u201d\u7684\uff0c\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u9700\u8981\u7ed9\u5176\u4ed6\u8d44\u6e90\u52a0\u9501\uff0c\u6216\u8005\u65e0\u6cd5\u5728\u7533\u8bf7\u5230\u81ea\u589eid\u4ee5\u540e\u5c31\u7acb\u9a6c\u91ca\u653e\u81ea\u589e\u9501\u3002</p><p>\u90a3\u4e48\uff0c\u4eca\u5929\u8fd9\u7bc7\u6587\u7ae0\uff0c\u6211\u4eec\u5c31\u4e00\u8d77\u6765\u804a\u804a\u8fd9\u4e2a\u8bdd\u9898\u3002</p><h1>insert \u2026 select \u8bed\u53e5</h1><p>\u6211\u4eec\u5148\u4ece\u6628\u5929\u7684\u95ee\u9898\u8bf4\u8d77\u5427\u3002\u8868t\u548ct2\u7684\u8868\u7ed3\u6784\u3001\u521d\u59cb\u5316\u6570\u636e\u8bed\u53e5\u5982\u4e0b\uff0c\u4eca\u5929\u7684\u4f8b\u5b50\u6211\u4eec\u8fd8\u662f\u9488\u5bf9\u8fd9\u4e24\u4e2a\u8868\u5c55\u5f00\u3002</p><pre><code>CREATE TABLE `t` (\n  `id` int(11) NOT NULL AUTO_INCREMENT,\n  `c` int(11) DEFAULT NULL,\n  `d` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `c` (`c`)\n) ENGINE=InnoDB;\n\ninsert into t values(null, 1,1);\ninsert into t values(null, 2,2);\ninsert into t values(null, 3,3);\ninsert into t values(null, 4,4);\n\ncreate table t2 like t\n</code></pre><p>\u73b0\u5728\uff0c\u6211\u4eec\u4e00\u8d77\u6765\u770b\u770b\u4e3a\u4ec0\u4e48\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0cbinlog_format=statement\u65f6\u6267\u884c\uff1a</p><pre><code>insert into t2(c,d) select c,d from t;\n</code></pre><p>\u8fd9\u4e2a\u8bed\u53e5\u65f6\uff0c\u9700\u8981\u5bf9\u8868t\u7684\u6240\u6709\u884c\u548c\u95f4\u9699\u52a0\u9501\u5462\uff1f</p><p>\u5176\u5b9e\uff0c\u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u9700\u8981\u8003\u8651\u7684\u8fd8\u662f\u65e5\u5fd7\u548c\u6570\u636e\u7684\u4e00\u81f4\u6027\u3002\u6211\u4eec\u770b\u4e0b\u8fd9\u4e2a\u6267\u884c\u5e8f\u5217\uff1a</p><p><img src=\"https://static001.geekbang.org/resource/image/33/86/33e513ee55d5700dc67f32bcdafb9386.png\" alt=\"\"></p><center><span class=\"reference\">\u56fe1 \u5e76\u53d1insert\u573a\u666f</span></center><p>\u5b9e\u9645\u7684\u6267\u884c\u6548\u679c\u662f\uff0c\u5982\u679csession B\u5148\u6267\u884c\uff0c\u7531\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u5bf9\u8868t\u4e3b\u952e\u7d22\u5f15\u52a0\u4e86(-\u221e,1]\u8fd9\u4e2anext-key lock\uff0c\u4f1a\u5728\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u5141\u8bb8session A\u7684insert\u8bed\u53e5\u6267\u884c\u3002</p><p>\u4f46\u5982\u679c\u6ca1\u6709\u9501\u7684\u8bdd\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0session B\u7684insert\u8bed\u53e5\u5148\u6267\u884c\uff0c\u4f46\u662f\u540e\u5199\u5165binlog\u7684\u60c5\u51b5\u3002\u4e8e\u662f\uff0c\u5728binlog_format=statement\u7684\u60c5\u51b5\u4e0b\uff0cbinlog\u91cc\u9762\u5c31\u8bb0\u5f55\u4e86\u8fd9\u6837\u7684\u8bed\u53e5\u5e8f\u5217\uff1a</p>", "video_width": 0, "column_could_sub": true, "article_ctime": 1549987200, "article_poster_wxlite": "https://static001.geekbang.org/render/screen/b6/0a/b6607e0b24cb4310dab2951ec221780a.jpeg"}