#!/usr/bin/env python
# coding:utf-8
# Copyright (C) dirlt

from typing import List


class Solution:
    def splitArray(self, nums: List[int]) -> int:
        M = max(nums)
        n = len(nums)
        factor = [0] * (M + 1)
        for i in range(2, M + 1):
            if factor[i] != 0:
                continue
            for j in range(1, M // i + 1):
                factor[i * j] = i

        inf = 1 << 30
        dp = [inf] * (M + 1)
        ans = 0

        for i in range(n):
            x = nums[i]
            res = ans + 1

            while x != 1:
                f = factor[x]
                dp[f] = min(dp[f], ans)
                res = min(dp[f] + 1, res)
                while x % f == 0:
                    x = x // f

            ans = res

        return ans


cases = [
    ([2, 3], 2),
    ([10, 20], 1),
    ([2, 3, 3, 2, 3, 3], 2),
    ([2, 3, 5, 7], 4),
    ([182933, 410093, 424267, 379433, 119881, 339589, 57331, 386237, 433439, 430147, 159169, 375253, 421559, 76679,
      348763, 239641, 273047, 159013, 208111, 382037, 160357, 335897, 548851, 690611, 752287, 635567, 713563, 792487,
      493351, 725867, 465893, 553873, 655601, 836833, 596231, 693691, 792277, 609887, 596879, 510613, 707429, 478697,
      676717, 666139, 704833, 741809, 656959, 723859, 782711, 501223, 770927, 754043, 682637, 617473, 811933, 796451,
      788891, 840491, 862997, 519119, 887017, 891557, 946753, 901679, 985003, 984947, 985177, 988279, 986813, 991069,
      990043, 990673, 991603, 987593, 989629, 994657, 994853, 996187, 996109, 993217, 996187, 994871, 992963, 992891,
      992983, 995051, 996763, 994871, 994249, 993341, 995329, 998281, 998539, 998111, 997439, 997699, 998017, 997663,
      998857, 999217], 91)
]

import aatest_helper

aatest_helper.run_test_cases(Solution().splitArray, cases)
